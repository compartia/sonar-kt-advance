language: java
sudo: required
install: true

addons:
  sonarcloud:
    organization: "compartia-github"
    token: $SONAR_TOKEN
    branches:
      - master
      - plug-sonarcloud

script: 
  - mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent package sonar:sonar

env:
- TEST=CI

before_deploy: 
  - "mkdir -p release"
  - "mv ./target/$(ls ./target|grep jar) ./release/sonar-kt-advance-plugin-$TRAVIS_TAG.jar"

deploy:
  provider: releases
  skip_cleanup: true

  file: target/sonar-kt-advance-plugin-$TRAVIS_TAG.jar
  api_key: $DEPLOY_KEY
  on:
    tags: true

